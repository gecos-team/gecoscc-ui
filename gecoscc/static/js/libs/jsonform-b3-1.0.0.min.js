(function(g,q,h,w,c){if(g){w=require("underscore")}var b=/\[([0-9]*)\](?=\[|\.|$)/g;var u={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};var t={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var r=function(y){return !(w.isUndefined(y)||w.isNull(y))};var a={util:{}};var m;var x;var k;var p=function(y){if(!r(y)){return""}y=""+y;if(!y){return""}return y.replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};var l=function(y){return y.replace(/([ \!\"\#\$\%\&\'\(\)\*\+\,\.\/\:\;<\=\>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")};var d=function(A){var B=function(E,D){D.find("> .active").removeClass("active");E.addClass("active")};var z=function(D,E){D.find("input, textarea, select").removeAttr("disabled");D.parent().children(":not([data-idx="+E+"])").find("input, textarea, select").attr("disabled","disabled")};var C=function(H){var G=h("option:selected",h(this)),E=h(this),F=G.get(0).getAttribute("data-idx")||G.attr("value"),D;H.preventDefault();if(G.hasClass("active")){return}D=h(this).parents(".tabbable").eq(0).find(".tab-content [data-idx="+F+"]");B(G,E);B(D,D.parent());z(D,F)};var y=function(H){var G=h("a",h(this));var E=h(this).parents(".tabbable").first().find(".tab-content").first();var F=h(this).index();var D=E.find("[data-idx="+F+"]");H.preventDefault();B(h(this),h(this).parent());B(D,D.parent());if(h(this).parent().hasClass("jsonform-alternative")){z(D,F)}};A.each(function(){h(this).delegate("select.nav","change",C);h(this).find("select.nav").each(function(){h(this).val(h(this).find(".active").attr("value"));var E=h(this).find("option:selected").get(0).getAttribute("data-idx")||h(this).find("option:selected").attr("value");var D=h(this).parents(".tabbable").eq(0).find(".tab-content [data-idx="+E+"]");z(D,E)});h(this).delegate("ul.nav li","click",y);h(this).find("ul.nav li.active").click()})};a.fieldTemplate=function(y){return'<div class="form-group jsonform-error-<%= keydash %><%= elt.htmlClass ? " " + elt.htmlClass : "" %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " jsonform-required" : "") %><%= (node.readOnly ? " jsonform-readonly" : "") %><%= (node.disabled ? " jsonform-disabled" : "") %>"><% if (node.title && !elt.notitle) { %><label class="col-sm-2 control-label" for="<%= node.id %>"><%= node.getLocalizedAttr("title") %></label><% } %><div class="<% if (!(node.title && !elt.notitle)) { print("col-sm-11 "); } else { print("col-sm-9 "); }%><% if (node.prepend || node.append) { print("input-group"); } %>"><% if (node.prepend) { %><span class="input-group-addon"><%= node.prepend %></span><% } %>'+y+'<% if (node.append) { %><span class="input-group-addon"><%= node.append %></span><% } %><% if (node.description) { %><span class="help-block"><%= node.getLocalizedAttr("description") %></span><% } %></div><span class="help-block jsonform-errortext text-danger col-sm-9 col-sm-offset-2" style="display:none;"></span></div>'};var s='<div class="_jsonform-preview"><% if (value.type=="image") { %><img class="jsonform-preview" id="jsonformpreview-<%= id %>" src="<%= value.url %>" /><% } else { %><a href="<%= value.url %>"><%= value.name %></a> (<%= Math.ceil(value.size/1024) %>kB)<% } %></div><a href="#" class="btn _jsonform-delete"><i class="icon-remove" title="Remove"></i></a> ';var o=function(y){return{template:'<input type="'+y+'" class="form-control <% if (fieldHtmlClass) { print(fieldHtmlClass); } %>" name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %><%= (node.placeholder? "placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%> />',fieldtemplate:true,inputfield:true}};a.elementTypes={none:{template:""},root:{template:"<div><%= children %></div>"},text:o("text"),password:o("password"),date:o("date"),datetime:o("datetime"),"datetime-local":o("datetime-local"),email:o("email"),month:o("month"),number:o("number"),search:o("search"),tel:o("tel"),time:o("time"),url:o("url"),week:o("week"),range:{template:'<input type="range" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%> min=<%= range.min %> max=<%= range.max %> step=<%= range.step %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> />',fieldtemplate:true,inputfield:true,onBeforeRender:function(z,y){z.range={min:1,max:100,step:1};if(!y||!y.schemaElement){return}if(y.formElement&&y.formElement.step){z.range.step=y.formElement.step}if(typeof y.schemaElement.minimum!=="undefined"){if(y.schemaElement.exclusiveMinimum){z.range.min=y.schemaElement.minimum+z.range.step}else{z.range.min=y.schemaElement.minimum}}if(typeof y.schemaElement.maximum!=="undefined"){if(y.schemaElement.exclusiveMaximum){z.range.max=y.schemaElement.maximum+z.range.step}else{z.range.max=y.schemaElement.maximum}}}},color:{template:'<input type="text" <%= (fieldHtmlClass ? "class=\'" + fieldHtmlClass + "\' " : "") %>name="<%= node.name %>" value="<%= escape(value) %>" id="<%= id %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %> />',fieldtemplate:true,inputfield:true,onInsert:function(y,z){h(z.el).find("#"+l(z.id)).spectrum({preferredFormat:"hex",showInput:true})}},textarea:{template:'<textarea id="<%= id %>" name="<%= node.name %>" class="form-control" style="height:<%= elt.height || "150px" %>;width:<%= elt.width || "100%" %>;"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? "placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:true,inputfield:true},wysihtml5:{template:'<textarea id="<%= id %>" name="<%= node.name %>" style="height:<%= elt.height || "300px" %>;width:<%= elt.width || "100%" %>;"<%= (node.disabled? " disabled" : "")%><%= (node.readOnly ? " readonly=\'readonly\'" : "") %><%= (node.schemaElement && node.schemaElement.maxLength ? " maxlength=\'" + node.schemaElement.maxLength + "\'" : "") %><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %><%= (node.placeholder? "placeholder=" + \'"\' + escape(node.placeholder) + \'"\' : "")%>><%= value %></textarea>',fieldtemplate:true,inputfield:true,onInsert:function(A,B){var y=function(){if(h(B.el).data("wysihtml5")){return}h(B.el).data("wysihtml5_loaded",true);h(B.el).find("#"+l(B.id)).wysihtml5({html:true,link:true,"font-styles":true,image:true,events:{load:function(){h(this.textareaElement).removeAttr("required")}}})};if(window.jsonform_wysihtml5_setup){window.jsonform_wysihtml5_setup(y);return}var z=window.setInterval(function(){if(window.wysihtml5){window.clearInterval(z);y()}},1000)}},ace:{template:'<div id="<%= id %>" style="position:relative;height:<%= elt.height || "300px" %>;"><div id="<%= id %>__ace" style="width:<%= elt.width || "100%" %>;height:<%= elt.height || "300px" %>;"></div><input type="hidden" name="<%= node.name %>" id="<%= id %>__hidden" value="<%= escape(value) %>"/></div>',fieldtemplate:true,inputfield:true,onInsert:function(A,B){var y=function(){var E=B.formElement||{};var D=window.ace;var C=D.edit(h(B.el).find("#"+l(B.id)+"__ace").get(0));var F="#"+l(B.id)+"__hidden";C.getSession().setNewLineMode("unix");C.renderer.setShowPrintMargin(false);C.setTheme("ace/theme/"+(E.aceTheme||"twilight"));if(E.aceMode){C.getSession().setMode("ace/mode/"+E.aceMode)}C.getSession().setTabSize(2);C.getSession().setValue(B.value||"");var G=w.debounce(function(){h(B.el).find(F).val(C.getSession().getValue());h(B.el).find(F).change()},600);C.getSession().on("change",G);C.on("blur",function(){h(B.el).find(F).change();h(B.el).find(F).trigger("blur")});C.on("focus",function(){h(B.el).find(F).trigger("focus")})};if(window.jsonform_ace_setup){window.jsonform_ace_setup(y);return}var z=window.setInterval(function(){if(window.ace){window.clearInterval(z);y()}},1000)}},checkbox:{template:'<div class="checkbox"><label><input type="checkbox" id="<%= id %>" name="<%= node.name %>" value="1" <% if (value) {%>checked<% } %><%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required && (node.schemaElement.type !== "boolean") ? " required=\'required\'" : "") %> /><%= node.inlinetitle || "" %></label></div>',fieldtemplate:true,inputfield:true,onInsert:function(z,B){if(B.formElement.toggleNext){var C=B.formElement.toggleNext===true?1:B.formElement.toggleNext;var A="jsonform-toggle-next jsonform-toggle-next-"+C;var y=C===1?h(B.el).parent().next():(C==="all"?h(B.el).parent().nextAll():h(B.el).parent().nextAll().slice(0,C));y.addClass("jsonform-toggle-next-target");h(B.el).addClass(A).find(":checkbox").on("change",function(){var E=h(this);var D=E.is(":checked");h(B.el).toggleClass("checked",D);y.toggle(D).toggleClass("jsonform-toggled-visible",D)}).change()}},getElement:function(y){return h(y).parent().get(0)}},file:{template:'<input class="input-file" id="<%= id %>" name="<%= node.name %>" type="file" <%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>/>',fieldtemplate:true,inputfield:true},"file-hosted-public":{template:"<span><% if (value && (value.type||value.url)) { %>"+s+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="<%= transloaditname %>" /><input data-transloadit-name="_transloadit_<%= transloaditname %>" type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:true,inputfield:true,getElement:function(y){return h(y).parent().get(0)},onBeforeRender:function(z,y){if(!y.ownerTree._transloadit_generic_public_index){y.ownerTree._transloadit_generic_public_index=1}else{y.ownerTree._transloadit_generic_public_index++}z.transloaditname="_transloadit_jsonform_genericupload_public_"+y.ownerTree._transloadit_generic_public_index;if(!y.ownerTree._transloadit_generic_elts){y.ownerTree._transloadit_generic_elts={}}y.ownerTree._transloadit_generic_elts[z.transloaditname]=y},onChange:function(y,z){if(z.ownerTree._transloadit_bound){return false}z.ownerTree._transloadit_bound=true;var A=h(z.ownerTree.domRoot);A.transloadit({autoSubmit:false,wait:true,onSuccess:function(B){var C=w.values(B.results);C=w.flatten(C);w.each(C,function(D){var G=z.ownerTree._transloadit_generic_elts[D.field].id;var E=A.find("#"+l(G));var F=w.filter(w.keys(D.meta),function(H){return !!r(D.meta[H])});D.meta=w.pick(D.meta,F);E.val(c.stringify(D))});z.ownerTree._transloadit_bound=false;A.unbind("submit.transloadit");w.delay(function(){console.log("submit form");z.ownerTree.submit()},10)},onError:function(B){console.log("assembly error",B)}})},onInsert:function(y,z){h(z.el).find("a._jsonform-delete").on("click",function(A){h(z.el).find("._jsonform-preview").remove();h(z.el).find("a._jsonform-delete").remove();h(z.el).find("#"+l(z.id)).val("");A.preventDefault();return false})},onSubmit:function(y,z){if(z.ownerTree._transloadit_bound){return false}return true}},"file-transloadit":{template:"<span><% if (value && (value.type||value.url)) { %>"+s+'<% } %><input class="input-file" id="_transloadit_<%= id %>" type="file" name="_transloadit_<%= node.name %>" /><input type="hidden" id="<%= id %>" name="<%= node.name %>" value=\'<%= escape(JSON.stringify(node.value)) %>\' /></span>',fieldtemplate:true,inputfield:true,getElement:function(y){return h(y).parent().get(0)},onChange:function(y,z){if(z.ownerTree._transloadit_bound){return false}z.ownerTree._transloadit_bound=true;var A=h(z.ownerTree.domRoot);A.transloadit({autoSubmit:false,wait:true,onSuccess:function(B){var C=w.values(B.results);C=w.flatten(C);w.each(C,function(D){var E=A.find('input[name="'+D.field.replace(/^_transloadit_/,"")+'"]');var F=w.filter(w.keys(D.meta),function(G){return !!r(D.meta[G])});D.meta=w.pick(D.meta,F);E.val(c.stringify(D))});z.ownerTree._transloadit_bound=false;A.unbind("submit.transloadit");w.delay(function(){console.log("submit form");z.ownerTree.submit()},10)},onError:function(B){console.log("assembly error",B)}})},onInsert:function(y,z){h(z.el).find("a._jsonform-delete").on("click",function(A){h(z.el).find("._jsonform-preview").remove();h(z.el).find("a._jsonform-delete").remove();h(z.el).find("#"+l(z.id)).val("");A.preventDefault();return false})},onSubmit:function(y,z){if(z.ownerTree._transloadit_bound){return false}return true}},select:{template:'<<%= (((node.parentNode.schemaElement && node.parentNode.schemaElement.autocomplete_url) || node.schemaElement.autocomplete_url) ? "input" : "select") %> name="<%= node.name %>" id="<%= id %>"class="form-control <% if (fieldHtmlClass) { print(fieldHtmlClass); } %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>> <% if (!((node.parentNode.schemaElement && node.parentNode.schemaElement.autocomplete_url) || node.schemaElement.autocomplete_url)) { %><% _.each(node.options, function(key, val) { if(key instanceof Object) { if (value === key.value) { %><option selected value="<%= key.value %>"><%= key.title %></option> <% } else { %> <option value="<%= key.value %>"><%= key.title %></option> <% }} else { if (value === key) { %> <option selected value="<%= key %>"><%= key %></option> <% } else { %><option value="<%= key %>"><%= key %></option><% }}}); %> <% } %> </<%= (((node.parentNode.schemaElement && node.parentNode.schemaElement.autocomplete_url) || node.schemaElement.autocomplete_url)? "input" : "select") %>>',fieldtemplate:true,inputfield:true,onInsert:function(K,B){var I=((B.parentNode.schemaElement&&B.parentNode.schemaElement.autocomplete_url)?B.parentNode.schemaElement:B.schemaElement),L,D=30,J,G,C={},y="",F={},E,A=false;var z=function(N,M){A=!w.some(N,function(O){return O.text==M});if(!A){return}N.push({text:M,value:M,id:M});B.schemaElement["enum"].push(M)};var H=function(){return k==="package"||k==="mobile_broadband"};if(!I||w.isUndefined(I)||w.isUndefined(I.autocomplete_url)){return}if(B.value&&!I.autocomplete_url.startsWith("javascript:")){h(B.el).addClass("hidden");if(H()){F={name:B.value}}else{F={oids:B.value}}L=h.ajax({url:I.autocomplete_url,dataType:"json",data:F})}else{L=h.Deferred();L.resolve()}h(B.el).append('<div class="alert alert-warning">'+gettext("Package not found in server repositories")+"</div>");h(B.el).find(".alert").hide();L.done(function(N){if(!w.isUndefined(N)){if((typeof(N.settings)!=="undefined")){nodes=[];var M=N.settings[0].value.replace(/[\[\]"]/g,"").split(",");if(M.length===0){B.schemaElement["enum"].push(B.value);h(B.el).find("input").attr("value",B.value);if(!w.isUndefined(N.packages)){E={name:B.value};h(B.el).find(".alert").show()}else{h(B.parentNode.el).find(".array-warning-message").removeClass("hidden");return}h(B.parentNode.el).find(".array-warning-message").removeClass("hidden");return}else{E={name:M[0],_id:M[0]}}}else{var P=N.nodes||N.packages||N.serviceproviders;if(P.length===0){B.schemaElement["enum"].push(B.value);h(B.el).find("input").attr("value",B.value);if(!w.isUndefined(N.packages)){E={name:B.value};h(B.el).find(".alert").show()}else{h(B.parentNode.el).find(".array-warning-message").removeClass("hidden");return}}else{E=P[0]}}}h(B.el).find("input").html("");if(I.autocomplete_url.startsWith("javascript:")){var O=I.autocomplete_url.split(":")[1];h(B.el).find("input").select2({query:function(Q){window[O](B,Q)},initSelection:function(Q,S){if(!w.isUndefined(B.value)){h(B.el).find("input").last().attr("value",B.value);B.schemaElement["enum"].push(B.value);var R={id:B.value,value:B.value,text:gettext(B.value)};S(R)}}})}else{h(B.el).find("input").select2({query:function(Q){if(y.length<Q.term.length&&!J){G=w.filter(G,function(S){var R=new RegExp(Q.term+".*","i");return R.test(S.text)});C[Q.term]=w.clone(G);if(H()){z(G,Q.term)}Q.callback({results:G})}else{if(C[Q.term]){if(H()){z(C[Q.term],Q.term)}Q.callback({results:C[Q.term]})}else{h.ajax({url:I.autocomplete_url,dataType:"json",id:function(R){return R._id},data:{item_id:m,ou_id:x,iname:Q.term,page:Q.page,pagesize:D},type:"GET",success:function(T){if((typeof(T.settings)!=="undefined")){nodes=[];var R=T.settings[0].value.replace(/[\[\]"]/g,"").split(",");for(var S=0;S<R.length;S++){nodes[S]={text:R[S],value:R[S],id:R[S]};B.schemaElement["enum"].push(R[S])}J=R.length>=D}else{var U=T.nodes||T.packages||T.serviceproviders;nodes=U.map(function(V){V._id=V._id||V.name;B.schemaElement["enum"].push(V._id);return{text:V.name,value:V._id,id:V._id}});J=U.length>=D}if(T.page===1){G=nodes}else{G=w.union(G,nodes)}Q.callback({results:nodes,more:J})}})}}y=Q.term},initSelection:function(Q,S){if(!w.isUndefined(E)){h(B.el).find("input").last().attr("value",E._id||E.name);B.schemaElement["enum"].push(E._id||E.name);var R={id:E._id||E.name,text:E.name};S(R)}}}).on("change",function(Q){if(Q.val!=y||!A){h(B.el).find(".alert").hide()}else{h(B.el).find(".alert").show()}})}h(B.el).removeClass("hidden")})}},imageselect:{template:'<div><input type="hidden" name="<%= node.name %>" id="<%= node.id %>" value="<%= value %>" /><div class="dropdown"><a class="btn<% if (buttonClass && node.value) { %> <%= buttonClass %><% } %>" data-toggle="dropdown" href="#"<% if (node.value) { %> style="max-width:<%= width %>px;max-height:<%= height %>px"<% } %>><% if (node.value) { %><img src="<% if (!node.value.match(/^https?:/)) { %><%= prefix %><% } %><%= node.value %><%= suffix %>" alt="" /><% } else { %><%= buttonTitle %><% } %></a><div class="dropdown-menu navbar" id="<%= node.id %>_dropdown"><div><% _.each(node.options, function(key, idx) { if ((idx > 0) && ((idx % columns) === 0)) { %></div><div><% } %><a class="btn<% if (buttonClass) { %> <%= buttonClass %><% } %>" style="max-width:<%= width %>px;max-height:<%= height %>px"><% if (key instanceof Object) { %><img src="<% if (!key.value.match(/^https?:/)) { %><%= prefix %><% } %><%= key.value %><%= suffix %>" alt="<%= key.title %>" /></a><% } else { %><img src="<% if (!key.match(/^https?:/)) { %><%= prefix %><% } %><%= key %><%= suffix %>" alt="" /><% } %></a> <% }); %></div><div class="pagination-right"><a class="btn">Reset</a></div></div></div></div>',fieldtemplate:true,inputfield:true,onBeforeRender:function(C,B){var A=B.formElement||{};var z=null;var y=A.imageSelectorColumns||5;C.buttonTitle=A.imageSelectorTitle||"Select...";C.prefix=A.imagePrefix||"";C.suffix=A.imageSuffix||"";C.width=A.imageWidth||32;C.height=A.imageHeight||32;C.buttonClass=A.imageButtonClass||false;if(B.options.length>y){z=Math.ceil(B.options.length/y);C.columns=Math.ceil(B.options.length/z)}else{C.columns=y}},getElement:function(y){return h(y).parent().get(0)},onInsert:function(y,z){h(z.el).on("click",".dropdown-menu a",function(B){B.preventDefault();B.stopPropagation();var C=(B.target.nodeName.toLowerCase()==="img")?h(B.target):h(B.target).find("img");var G=C.attr("src");var D=z.formElement||{};var F=D.imagePrefix||"";var H=D.imageSuffix||"";var E=D.imageWidth||32;var A=D.imageHeight||32;if(G){if(G.indexOf(F)===0){G=G.substring(F.length)}G=G.substring(0,G.length-H.length);h(z.el).find("input").attr("value",G);h(z.el).find('a[data-toggle="dropdown"]').addClass(D.imageButtonClass).attr("style","max-width:"+E+"px;max-height:"+A+"px").html('<img src="'+(!G.match(/^https?:/)?F:"")+G+H+'" alt="" />')}else{h(z.el).find("input").attr("value","");h(z.el).find('a[data-toggle="dropdown"]').removeClass(D.imageButtonClass).removeAttr("style").html(D.imageSelectorTitle||"Select...")}})}},radios:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><div class="radio"><label><input type="radio" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>"<%= (node.disabled? " disabled" : "")%><%= (node.schemaElement && node.schemaElement.required ? " required=\'required\'" : "") %>/><%= (key instanceof Object ? key.title : key) %></label></div><% }); %></div>',fieldtemplate:true,inputfield:true},radiobuttons:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><div class="radio"><label class="radio btn"><input type="radio" style="position:absolute;left:-9999px;" <% if (((key instanceof Object) && (value === key.value)) || (value === key)) { %> checked="checked" <% } %> name="<%= node.name %>" value="<%= (key instanceof Object ? key.value : key) %>" /><%= (key instanceof Object ? key.title : key) %></label></div><% }); %></div>',fieldtempate:true,inputfield:true,onInsert:function(y,B){var A="active";var z=B.formElement||{};if(z.activeClass){A+=" "+z.activeClass}h(B.el).find("label").on("click",function(){h(this).parent().find("label").removeClass(A);h(this).addClass(A)})}},checkboxes:{template:'<div class="checkbox"><%= choiceshtml %></div>',fieldtemplate:true,inputfield:true,onBeforeRender:function(B,z){var C=null;var A=null;var y='<label><input type="checkbox" <% if (value) { %> checked="checked" <% } %> name="<%= name %>" value="1"<%= (node.disabled? " disabled" : "")%>/> <%= title %></label>';if(!z||!z.schemaElement||!z.schemaElement.items){return}C=z.schemaElement.items["enum"]||z.schemaElement.items[0]["enum"];if(!C){return}A="";w.each(C,function(E,D){A+=w.template(y,{name:z.key+"["+D+"]",value:w.include(z.value,E),title:z.formElement.titleMap?z.formElement.titleMap[E]:E,node:z},u)});B.choiceshtml=A}},array:{template:'<div id="<%= id %>"><input type="hidden" name="<%= node.name %>" value="[]" /><ul class="_jsonform-array-ul" style="list-style-type:none;"><%= children %></ul><span class="_jsonform-array-buttons"><a href="#" class="btn btn-default btn-xs _jsonform-array-addmore"><span class="fa fa-plus" title="Add new"></span></a> </span></div> <div class="col-sm-12 array-warning-message hidden"><div class="alert alert-warning"></div></div>',fieldtemplate:true,array:true,childTemplate:function(y){if(h("").sortable){return'<li data-idx="<%= node.childPos %>"><span class="draggable line"><i class="icon-list" title="Move item"></i></span>'+y+"</li>"}else{return'<li class=<% if (_.isUndefined(node.title) || node.type !== "object") { %> "col-sm-12 separator" <% } else { %> "col-sm-offset-1 col-sm-11 separator" <% } %>data-idx="<%= node.childPos %>"><a href="#" class="pull-right btn btn-default btn-xs _jsonform-array-deleteidx"><span class="fa fa-minus" title="Delete item"></span></a>'+y+"</li>"}},onInsert:function(y,D){var F=h(D.el).find("#"+l(D.id));var z=D.getArrayBoundaries();D.resetDeleteEvents();var C=D.schemaElement&&(D.schemaElement["title_"+App.language]||D.title)+" "+gettext("contains items that are outside your scope, please consult a global administrator if you need more information.");h(D.el).find(".alert-warning").html(C);var E=function(I,K){if(I===K){return}var M=(I<K)?1:-1;var G=0;var H=h("> ul",F);for(G=I;G!==K;G+=M){D.children[G].switchValuesWith(D.children[G+M]);D.children[G].render(H.get(0));D.children[G+M].render(H.get(0))}var L=h(D.children[I].el);var J=h(D.children[K].el);L.detach();J.detach();if(I<K){if(I===0){H.prepend(L)}else{h(D.children[I-1].el).after(L)}h(D.children[K-1].el).after(J)}else{if(K===0){H.prepend(J)}else{h(D.children[K-1].el).after(J)}h(D.children[I-1].el).after(L)}};h("> span > a._jsonform-array-addmore",F).click(function(H){H.preventDefault();H.stopPropagation();var G=D.children.length;if(z.maxItems>=0){if(D.children.length>z.maxItems-2){F.find("> span > a._jsonform-array-addmore").addClass("disabled")}if(D.children.length>z.maxItems-1){return false}}D.insertArrayItem(G,h("> ul",F).get(0));JSONForm.initializeTabs(h("form"));if((z.minItems<=0)||((z.minItems>0)&&(D.children.length>z.minItems-1))){F.find("> span > a._jsonform-array-deletelast").removeClass("disabled")}});var A=h("> ul > li",F).length;if((z.minItems>0)&&(A<z.minItems)){for(var B=0;B<(z.minItems-1)&&(F.find("> ul > li").length<z.minItems);B++){D.insertArrayItem(A,F.find("> ul").get(0))}}if((z.minItems>0)&&(D.children.length<=z.minItems)){F.find("> span > a._jsonform-array-deletelast").addClass("disabled")}h("> span > a._jsonform-array-deletelast",F).click(function(H){var G=D.children.length-1;H.preventDefault();H.stopPropagation();if(z.minItems>0){if(D.children.length<z.minItems+2){F.find("> span > a._jsonform-array-deletelast").addClass("disabled")}if(D.children.length<=z.minItems){return false}}else{if(D.children.length===1){F.find("> span > a._jsonform-array-deletelast").addClass("disabled")}}D.deleteArrayItem(G);if((z.maxItems>=0)&&(G<=z.maxItems-1)){F.find("> span > a._jsonform-array-addmore").removeClass("disabled")}});if(h(D.el).sortable){h("> ul",F).sortable();h("> ul",F).bind("sortstop",function(I,J){var G=h(J.item).data("idx");var H=h(J.item).index();E(G,H)})}w.each(h(D.el).find("li"),function(G){h(G).find(".collapse").first().removeClass("collapse")})}},tabarray:{template:'<div id="<%= id %>"><div class="tabbable tabs-left"><ul class="nav nav-tabs"><%= tabs %></ul><div class="tab-content"><%= children %></div></div><a href="#" class="btn btn-default btn-xs _jsonform-array-addmore"><span class="fa fa-plus" title="Add new"></span></a> <a href="#" class="btn btn-default btn-xs _jsonform-array-deleteitem"><span class="fa fa-minus" title="Delete item"></span></a></div>',fieldtemplate:true,array:true,childTemplate:function(y){return'<div data-idx="<%= node.childPos %>" id="<%= node.childPos %>" class="tab-pane">'+y+"</div>"},onBeforeRender:function(A,z){var y="";w.each(z.children,function(D,B){var C=D.legend||D.title||("Item "+(B+1));y+='<li data-idx="'+B+'"'+((B===0)?' class="active"':"")+'><a href="#'+B+'" class="draggable tab" data-toggle="tab">'+p(C)+"</a></li>"});A.tabs=y},onInsert:function(z,C){var E=h(C.el).find("#"+l(C.id));var A=C.getArrayBoundaries();var D=function(G,H){if(G===H){return}var J=(G<H)?1:-1;var F=0;var I=h("> .tabbable > .tab-content",E).get(0);for(F=G;F!==H;F+=J){C.children[F].switchValuesWith(C.children[F+J]);C.children[F].render(I);C.children[F+J].render(I)}};var y=function(F){var H="";var G=false;if(F===undefined){F=h("> .tabbable > .nav-tabs .active",E).data("idx");if(F){F=parseInt(F,10)}else{G=true;F=0}}if(F>=C.children.length){F=C.children.length-1}w.each(C.children,function(K,I){var J=K.legend||K.title||("Item "+(I+1));H+='<li data-idx="'+I+'"><a href="#'+I+'" class="draggable tab" data-toggle="tab">'+p(J)+"</a></li>"});h("> .tabbable > .nav-tabs",E).html(H);if(G){h('> .tabbable > .nav-tabs [data-idx="0"]',E).addClass("active")}h('> .tabbable > .nav-tabs [data-toggle="tab"]',E).eq(F).click()};h("> a._jsonform-array-deleteitem",E).click(function(G){var F=h("> .tabbable > .nav-tabs .active",E).data("idx");G.preventDefault();G.stopPropagation();if(A.minItems>0){if(C.children.length<A.minItems+1){E.find("> a._jsonform-array-deleteitem").addClass("disabled")}if(C.children.length<=A.minItems){return false}}C.deleteArrayItem(F);y();if((C.children.length<A.minItems+1)||(C.children.length===0)){E.find("> a._jsonform-array-deleteitem").addClass("disabled")}if((A.maxItems>=0)&&(C.children.length<=A.maxItems)){E.find("> a._jsonform-array-addmore").removeClass("disabled")}});h("> a._jsonform-array-addmore",E).click(function(G){var F=C.children.length;if(A.maxItems>=0){if(C.children.length>A.maxItems-2){h("> a._jsonform-array-addmore",E).addClass("disabled")}if(C.children.length>A.maxItems-1){return false}}G.preventDefault();G.stopPropagation();C.insertArrayItem(F,E.find("> .tabbable > .tab-content").get(0));y(F);if((A.minItems<=0)||((A.minItems>0)&&(F>A.minItems-1))){E.find("> a._jsonform-array-deleteitem").removeClass("disabled")}});h(C.el).on("legendUpdated",function(F){y();F.preventDefault();F.stopPropagation()});if(h(C.el).sortable){h("> .tabbable > .nav-tabs",E).sortable({containment:C.el,tolerance:"pointer"});h("> .tabbable > .nav-tabs",E).bind("sortstop",function(H,I){var F=h(I.item).data("idx");var G=h(I.item).index();D(F,G);y(G)})}if(A.minItems>=0){for(var B=0;B<(A.minItems-1);B++){E.find("> a._jsonform-array-addmore").click()}E.find("> a._jsonform-array-deleteitem").addClass("disabled");y()}if((A.maxItems>=0)&&(C.children.length>=A.maxItems)){E.find("> a._jsonform-array-addmore").addClass("disabled")}if((A.minItems>=0)&&(C.children.length<=A.minItems)){E.find("> a._jsonform-array-deleteitem").addClass("disabled")}}},help:{template:'<span class="help-block" style="padding-top:5px"><%= elt.helpvalue %></span>',fieldtemplate:true},msg:{template:"<%= elt.msg %>"},fieldset:{template:'<fieldset class="jsonform-error-<%= keydash %> <% if (elt.expandable) { %>expandable<% } %> <%= elt.htmlClass?elt.htmlClass:"" %>" <% if (id) { %> id="<%= id %>"<% } %>><% if (node.title || node.legend) { %><legend><span id="caret" class="fa fa-caret-right"></span> <%= node.getLocalizedAttr("title") || node.legend %></legend><% } %><div <% if (node.title || node.legend) { %> class="collapse" <% } %>><%= children %></div></fieldset>'},advancedfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend>Advanced options</legend><div><%= children %></div></fieldset>'},authfieldset:{template:'<fieldset<% if (id) { %> id="<%= id %>"<% } %> class="expandable <%= elt.htmlClass?elt.htmlClass:"" %>"><legend>Authentication settings</legend><div><%= children %></div></fieldset>'},submit:{template:'<input type="submit" <% if (id) { %> id="<%= id %>" <% } %> class="btn btn-primary <%= elt.htmlClass?elt.htmlClass:"" %>" value="<%= value || node.title %>"<%= (node.disabled? " disabled" : "")%>/>'},button:{template:' <button <% if (id) { %> id="<%= id %>" <% } %> class="btn <%= elt.htmlClass?elt.htmlClass:"btn-default" %>"><%= node.getLocalizedAttr("title") %></button> '},actions:{template:'<div class="<%= elt.htmlClass?elt.htmlClass:"" %>"><%= children %></div>'},hidden:{template:'<input type="hidden" id="<%= id %>" name="<%= node.name %>" value="<%= escape(value) %>" />',inputfield:true},selectfieldset:{template:'<fieldset class="tab-container <%= elt.htmlClass?elt.htmlClass:"" %>"><% if (node.legend) { %><legend><%= node.legend %></legend><% } %><% if (node.formElement.key) { %><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><% } else { %><a id="<%= node.id %>"></a><% } %><div class="tabbable"><div class="control-group<%= node.formElement.hideMenu ? " hide" : " control-group-action" %>"><% if (node.title && !elt.notitle) { %><label class="col-sm-2 control-label control-label-action" for="<%= node.id %>"><%= node.getLocalizedAttr("title") %></label><% } %><div class="controls col-sm-9"><%= tabs %></div></div><div class="tab-content"><%= children %></div></div></fieldset>',inputfield:true,getElement:function(y){return h(y).parent().get(0)},childTemplate:function(y){return'<div data-idx="<%= node.childPos %>" class="tab-pane<% if (node.active) { %> active<% } %>">'+y+"</div>"},onBeforeRender:function(D,B){var A=null;var E=[];if(B.schemaElement){E=B.schemaElement["enum"]||[]}if(B.options){A=w.map(B.options,function(G,F){var H=B.children[F];H.childPos=F;if(G instanceof Object){G=w.extend({node:H},G);G.title=G.title||H.legend||H.title||("Option "+(H.childPos+1));G.value=r(G.value)?G.value:r(E[F])?E[F]:F;return G}else{return{title:G,value:r(E[H.childPos])?E[H.childPos]:H.childPos,node:H}}})}else{A=w.map(B.children,function(G,F){return{title:G.legend||G.title||("Option "+(G.childPos+1)),value:E[G.childPos]||G.childPos,node:G}})}var C=null;if(D.value){C=w.find(A,function(F){return(F.value===B.value)})}if(!C){C=w.find(A,function(F){return F.node.hasNonDefaultValue()})}if(!C){C=A[0]}C.node.active=true;D.value=C.value;var y=B.formElement;var z='<select class="nav select-action"'+(B.disabled?" disabled":"")+">";w.each(A,function(G,F){z+='<option data-idx="'+F+'" value="'+G.value+'"'+(G.node.active?' class="active"':"")+">"+p(G.title)+"</option>"});z+="</select>";D.tabs=z;return D},onInsert:function(y,z){h(z.el).find("select.nav").first().on("change",function(A){var B=h(this).find("option:selected");h(z.el).find('input[type="hidden"]').first().val(B.attr("value"))})}},optionfieldset:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},section:{template:'<div<% if (node.id) { %> id="<%= node.id %>"<% } %>><%= children %></div>'},questions:{template:'<div><input type="hidden" id="<%= node.id %>" name="<%= node.name %>" value="<%= escape(value) %>" /><%= children %></div>',fieldtempate:true,inputfield:true,getElement:function(y){return h(y).parent().get(0)},onInsert:function(y,z){if(!z.children||(z.children.length===0)){return}w.each(z.children,function(A){h(A.el).hide()});h(z.children[0].el).show()}},question:{template:'<div id="<%= node.id %>"><% _.each(node.options, function(key, val) { %><div class="radio"><label class="<%= ((key instanceof Object && key.htmlClass) ? " " + key.htmlClass : "") %>"><input type="radio" <% if (node.formElement.optionsType === "radiobuttons") { %> style="position:absolute;left:-9999px;" <% } %>name="<%= node.id %>" value="<%= val %>"<%= (node.disabled? " disabled" : "")%>/><%= (key instanceof Object ? key.title : key) %></label></div><% }); %></div>',fieldtemplate:true,onInsert:function(y,B){var A="active";var z=B.formElement||{};if(z.activeClass){A+=" "+z.activeClass}h(B.el).find('input[type="radio"]').on("change",function(C){var D=null;var E=B.options[h(this).val()];if(!B.parentNode||!B.parentNode.el){return}h(this).parent().parent().find("label").removeClass(A);h(this).parent().addClass(A);h(B.el).nextAll().hide();h(B.el).nextAll().find('input[type="radio"]').prop("checked",false);if(E.value){h(B.parentNode.el).find('input[type="hidden"]').val(E.value)}if(E.next){D=w.find(B.parentNode.children,function(F){return(F.formElement&&(F.formElement.qid===E.next))});h(D.el).show();h(D.el).nextAll().hide();h(D.el).nextAll().find('input[type="radio"]').prop("checked",false)}if(E.href){if(E.target){window.open(E.href,E.target)}else{window.location=E.href}}if(E.submit){setTimeout(function(){B.ownerTree.submit()},0)}})}}};a.util.getObjKey=function(C,G,E){var D=C;var z=G.split(".");var A=null;var F=null;var y=null;for(var B=0;B<z.length;B++){if((D===null)||(typeof D!=="object")){return null}A=z[B];y=A.replace(b,"");b.lastIndex=0;F=b.exec(A);if(F){while(true){if(!w.isArray(D[y])){return null}D=D[y][parseInt(F[1],10)];F=b.exec(A);if(!F){break}}}else{if(E&&!D[y]&&w.isArray(D)&&D[0]){D=D[0][y]}else{D=D[y]}}}if(E&&w.isArray(D)&&D[0]){return D[0]}else{return D}};a.util.setObjKey=function(C,G,F){var D=C;var z=G.split(".");var A=null;var E=null;var y=null;for(var B=0;B<z.length-1;B++){A=z[B];y=A.replace(b,"");b.lastIndex=0;E=b.exec(A);if(E){while(true){if(!w.isArray(D[y])){D[y]=[]}D=D[y];y=parseInt(E[1],10);E=b.exec(A);if(!E){break}}if((typeof D[y]!=="object")||(D[y]===null)){D[y]={}}D=D[y]}else{if((typeof D[y]!=="object")||(D[y]===null)){D[y]={}}D=D[y]}}A=z[z.length-1];y=A.replace(b,"");b.lastIndex=0;E=b.exec(A);if(E){while(true){if(!w.isArray(D[y])){D[y]=[]}D=D[y];y=parseInt(E[1],10);E=b.exec(A);if(!E){break}}D[y]=F}else{D[y]=F}};var n=function(B,A){var y=A.replace(/\./g,".properties.").replace(/\[[0-9]*\]/g,".items");var z=a.util.getObjKey(B,y,true);if(z&&z.$ref){throw new Error("JSONForm does not yet support schemas that use the $ref keyword. See: https://github.com/joshfire/jsonform/issues/54")}return z};var v=function(y,z){var A=0;var B=0;if(!y){return null}if(z>0){while(A<z){B=y.indexOf("[]",B);if(B===-1){return y}B=B+2;A+=1}}B=y.indexOf("[]",B);if(B===-1){return y}else{return y.substring(0,B)}};var f=function(z,y){var B=0;if(!z){return null}if(!y||(y.length===0)){return z}var A=z.replace(b,function(E,D){var C=E;if(r(y[B])){C="["+y[B]+"]"}B+=1;return C});return A};var e=function(G,E,F,z,y){var D=null;z=z||{};z.idx=z.idx||(F?F[F.length-1]:1);z.value=r(z.value)?z.value:"";z.getValue=z.getValue||function(H){return e(G,H,F,z,y)};var B=function(J,H){var I=null;if(!J||!J.length){return null}w.each(J,function(K){if(I){return}if(K===H){I={key:K};return}if(w.isString(K)){return}if(K.key===H){I=K}else{if(K.items){I=B(K.items,H)}}});return I};var C=B(G.form||[],E);var A=n(G.schema.properties,E);if(y&&G.value){D=a.util.getObjKey(G.value,f(E,F))}if(!r(D)){if(C&&(typeof C.value!=="undefined")){D=C.value}else{if(A){if(r(A["default"])){D=A["default"]}}}if(D&&D.indexOf("{{values.")!==-1){D=D.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')}if(D){D=w.template(D,z,t)}}if(r(D)&&C&&C.titleMap&&C.titleMap[D]){D=w.template(C.titleMap[D],z,t)}if(D&&w.isString(D)&&A&&A.maxLength){if(D.length>A.maxLength){D=D.substr(0,A.maxLength-1)+"â€¦"}}if(!r(D)){return null}else{return D}};var j=function(){this.id=null;this.key=null;this.el=null;this.formElement=null;this.schemaElement=null;this.view=null;this.children=[];this.ownerTree=null;this.parentNode=null;this.childTemplate=null;this.legendChild=null;this.arrayPath=[];this.childPos=0;this.lan=(window.navigator.language||navigator.browserLanguage).slice(0,2)};j.prototype.clone=function(y){var z=new j();z.arrayPath=w.clone(this.arrayPath);z.ownerTree=this.ownerTree;z.parentNode=y||this.parentNode;z.formElement=this.formElement;z.schemaElement=this.schemaElement;z.view=this.view;z.children=w.map(this.children,function(A){return A.clone(z)});if(this.childTemplate){z.childTemplate=this.childTemplate.clone(z)}return z};j.prototype.hasNonDefaultValue=function(){if(this.formElement&&this.formElement.type=="hidden"){return false}if(this.value&&!this.defaultValue){return true}var y=w.find(this.children,function(z){return z.hasNonDefaultValue()});return !!y};j.prototype.appendChild=function(y){y.parentNode=this;y.childPos=this.children.length;this.children.push(y);return y};j.prototype.removeChild=function(){var y=this.children[this.children.length-1];if(!y){return}h(y.el).remove();return this.children.pop()};j.prototype.moveValuesTo=function(z){var y=this.getFormValues(z.arrayPath);z.resetValues();z.computeInitialValues(y,true)};j.prototype.switchValuesWith=function(z){var y=this.getFormValues(z.arrayPath);var A=z.getFormValues(this.arrayPath);z.resetValues();z.computeInitialValues(y,true);this.resetValues();this.computeInitialValues(A,true)};j.prototype.resetValues=function(){var z=null;var y=0;this.value=null;if(this.parentNode){this.arrayPath=w.clone(this.parentNode.arrayPath);if(this.parentNode.view&&this.parentNode.view.array){this.arrayPath.push(this.childPos)}}else{this.arrayPath=[]}if(this.view&&this.view.inputfield){z=h(":input",this.el).serializeArray();w.each(z,function(A){h('[name="'+l(A.name)+'"]',h(this.el)).val("")},this)}else{if(this.view&&this.view.array){while(this.children.length>0){this.removeChild()}}}w.each(this.children,function(A){A.resetValues()})};j.prototype.setChildTemplate=function(y){this.childTemplate=y;y.parentNode=this};j.prototype.computeInitialValues=function(z,B){var y=this;var C=null;var D=1;var A=0;var E=this.ownerTree.formDesc.tpldata||{};if(this.parentNode){this.arrayPath=w.clone(this.parentNode.arrayPath);if(this.parentNode.view&&this.parentNode.view.array){this.arrayPath.push(this.childPos)}}else{this.arrayPath=[]}E.idx=(this.arrayPath.length>0)?this.arrayPath[this.arrayPath.length-1]+1:this.childPos+1;E.value="";E.getValue=function(F){return e(y.ownerTree.formDesc,F,y.arrayPath,E,!!z)};if(this.formElement){if(this.formElement.id){this.id=f(this.formElement.id,this.arrayPath)}else{if(this.view&&this.view.array){this.id=l(this.ownerTree.formDesc.prefix)+"-elt-counter-"+w.uniqueId()}else{if(this.parentNode&&this.parentNode.view&&this.parentNode.view.array){this.id=l(this.ownerTree.formDesc.prefix)+"-elt-counter-"+w.uniqueId()}else{if((this.formElement.type==="button")||(this.formElement.type==="selectfieldset")||(this.formElement.type==="question")||(this.formElement.type==="buttonquestion")){this.id=l(this.ownerTree.formDesc.prefix)+"-elt-counter-"+w.uniqueId()}}}}if(this.formElement.key){this.key=f(this.formElement.key,this.arrayPath);this.keydash=this.key.replace(/\./g,"---")}this.name=f(this.formElement.name,this.arrayPath);w.each(["title","legend","description","append","prepend","inlinetitle","helpvalue","value","disabled","placeholder","readOnly"],function(F){if(w.isString(this.formElement[F])){if(this.formElement[F].indexOf("{{values.")!==-1){this[F]=this.formElement[F].replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')}else{this[F]=f(this.formElement[F],this.arrayPath)}if(this[F]){this[F]=w.template(this[F],E,t)}}else{this[F]=this.formElement[F]}},this);if(this.formElement.options){this.options=w.map(this.formElement.options,function(F){var G=null;if(w.isObject(F)&&F.title){if(F.title.indexOf("{{values.")!==-1){G=F.title.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')}else{G=f(F.title,y.arrayPath)}return w.extend({},F,{value:(r(F.value)?F.value:""),title:w.template(G,E,t)})}else{return F}})}}if(this.view&&this.view.inputfield&&this.schemaElement){if(z){if(r(a.util.getObjKey(z,this.key))){this.value=a.util.getObjKey(z,this.key)}}else{if(!B){if(!r(this.value)&&r(this.schemaElement["default"])){this.value=this.schemaElement["default"];if(w.isString(this.value)){if(this.value.indexOf("{{values.")!==-1){this.value=this.value.replace(/\{\{values\.([^\}]+)\}\}/g,'{{getValue("$1")}}')}else{this.value=f(this.value,this.arrayPath)}if(this.value){this.value=w.template(this.value,E,t)}}this.defaultValue=true}}}}else{if(this.view&&this.view.array){D=0;if(z){D=this.getPreviousNumberOfItems(z,this.arrayPath)}else{if(D===0){D=1}}for(A=0;A<D;A++){this.appendChild(this.childTemplate.clone())}}}w.each(this.children,function(F){F.computeInitialValues(z,B)});if(this.formElement&&this.formElement.valueInLegend){C=this;while(C){if(C.parentNode&&C.parentNode.view&&C.parentNode.view.array){C.legendChild=this;if(C.formElement&&C.formElement.legend){C.legend=f(C.formElement.legend,C.arrayPath);E.idx=(C.arrayPath.length>0)?C.arrayPath[C.arrayPath.length-1]+1:C.childPos+1;E.value=r(this.value)?this.value:"";C.legend=w.template(C.legend,E,t);break}}C=C.parentNode}}};j.prototype.getPreviousNumberOfItems=function(B,A){var C=null;var D=null;var z=null;var y=0;if(!B){return 0}if(this.view.inputfield&&this.schemaElement){C=v(this.formElement.key,A.length);C=f(C,A);D=a.util.getObjKey(B,C);if(!D){return 0}z=w.map(this.children,function(E){return E.getPreviousNumberOfItems(B,A)});return w.max([w.max(z)||0,D.length])}else{if(this.view.array){return this.childTemplate.getPreviousNumberOfItems(B,A)}else{z=w.map(this.children,function(E){return E.getPreviousNumberOfItems(B,A)});return w.max(z)||0}}};j.prototype.getFormValues=function(F){var G={};if(!this.el){throw new Error("formNode.getFormValues can only be called on nodes that are associated with a DOM element in the tree")}var E=h(":input",this.el).serializeArray();E=E.concat(h(":input[type=checkbox]:not(:disabled):not(:checked)",this.el).map(function(){return{name:this.name,value:this.checked}}).get());if(F){w.each(E,function(I){I.name=f(I.name,F)})}var H=this.ownerTree.formDesc.schema;for(var A=0;A<E.length;A++){var y=E[A].name;var C=n(H.properties,y);var D=null;var z=null;if(!C){continue}if(C._jsonform_checkboxes_as_array){D=y.match(/\[([0-9]*)\]$/);if(D){y=y.replace(/\[([0-9]*)\]$/,"");z=a.util.getObjKey(G,y)||[];if(E[A].value==="1"){z.push(C["enum"][parseInt(D[1],10)])}a.util.setObjKey(G,y,z);continue}}if(C.type==="boolean"){if(E[A].value==="0"){E[A].value=false}else{E[A].value=!!E[A].value}}if((C.type==="number")||(C.type==="integer")){if(w.isString(E[A].value)){if(!E[A].value.length){E[A].value=null}else{if(!isNaN(Number(E[A].value))){E[A].value=Number(E[A].value)}}}}if((C.type==="string")&&(E[A].value==="")&&!C._jsonform_allowEmpty){E[A].value=null}if((C.type==="object")&&w.isString(E[A].value)&&(E[A].value.substring(0,1)==="{")){try{E[A].value=c.parse(E[A].value)}catch(B){E[A].value={}}}if((C.type==="array")&&(E[A].value==="[]")&&w.isUndefined(G[E[A].name])){a.util.setObjKey(G,E[A].name,[]);continue}if((C.type==="object")&&(E[A].value==="null"||E[A].value==="")){E[A].value=null}if(E[A].name&&(E[A].value!==null)){a.util.setObjKey(G,E[A].name,E[A].value)}}return G};j.prototype.render=function(z){var y=this.generate();this.setContent(y,z);this.enhance()};j.prototype.getLocalizedAttr=function(y,z){z=z||this.lan;return this.formElement[y+"_"+z]||this.schemaElement[y+"_"+z]||this[y]};j.prototype.setContent=function(z,A){var B=h(z);var y=A||(this.parentNode?this.parentNode.el:this.ownerTree.domRoot);var C=null;if(this.el){h(this.el).replaceWith(B)}else{C=h(y).children().get(this.childPos);if(C){h(C).before(B)}else{h(y).append(B)}}this.el=B;this.updateElement(this.el)};j.prototype.updateElement=function(y){if(this.id){this.el=h("#"+l(this.id),y).get(0);if(this.view&&this.view.getElement){this.el=this.view.getElement(this.el)}if((this.fieldtemplate!==false)&&this.view&&this.view.fieldtemplate){this.el=h(this.el).parent().parent();if(this.prepend||this.prepend){this.el=this.el.parent()}this.el=this.el.get(0)}if(this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate){this.el=h(this.el).parent().get(0)}}w.each(this.children,function(z){z.updateElement(this.el||y)})};j.prototype.generate=function(){var A={id:this.id,keydash:this.keydash,elt:this.formElement,schema:this.schemaElement,node:this,value:r(this.value)?this.value:"",escape:p};var z=null;var y="";if(this.ownerTree.formDesc.onBeforeRender){this.ownerTree.formDesc.onBeforeRender(A,this)}if(this.view.onBeforeRender){this.view.onBeforeRender(A,this)}if(this.template){z=this.template}else{if(this.formElement&&this.formElement.template){z=this.formElement.template}else{z=this.view.template}}if((this.fieldtemplate!==false)&&(this.fieldtemplate||this.view.fieldtemplate)){z=a.fieldTemplate(z)}if(this.parentNode&&this.parentNode.view&&this.parentNode.view.childTemplate){z=this.parentNode.view.childTemplate(z)}var B="";w.each(this.children,function(C){B+=C.generate()});A.children=B;A.fieldHtmlClass="";if(this.ownerTree&&this.ownerTree.formDesc&&this.ownerTree.formDesc.params&&this.ownerTree.formDesc.params.fieldHtmlClass){A.fieldHtmlClass=this.ownerTree.formDesc.params.fieldHtmlClass}if(this.formElement&&(typeof this.formElement.fieldHtmlClass!=="undefined")){A.fieldHtmlClass=this.formElement.fieldHtmlClass}y=w.template(z,A,u);return y};j.prototype.enhance=function(){var A=this;var y=null;var z=null;var B=w.clone(this.ownerTree.formDesc.tpldata)||{};if(this.formElement){if(this.view.onInsert){this.view.onInsert({target:h(this.el)},this)}y=this.handlers||this.formElement.handlers;z=this.onInsert||this.formElement.onInsert;if(z){z({target:h(this.el)},this)}if(y){w.each(y,function(D,C){if(C==="insert"){D({target:h(this.el)},this)}},this)}if(this.el){if(this.onChange){h(this.el).bind("change",function(C){A.onChange(C,A)})}if(this.view.onChange){h(this.el).bind("change",function(C){A.view.onChange(C,A)})}if(this.formElement.onChange){h(this.el).bind("change",function(C){A.formElement.onChange(C,A)})}if(this.onClick){h(this.el).bind("click",function(C){A.onClick(C,A)})}if(this.view.onClick){h(this.el).bind("click",function(C){A.view.onClick(C,A)})}if(this.formElement.onClick){h(this.el).bind("click",function(C){A.formElement.onClick(C,A)})}if(this.onKeyUp){h(this.el).bind("keyup",function(C){A.onKeyUp(C,A)})}if(this.view.onKeyUp){h(this.el).bind("keyup",function(C){A.view.onKeyUp(C,A)})}if(this.formElement.onKeyUp){h(this.el).bind("keyup",function(C){A.formElement.onKeyUp(C,A)})}if(y){w.each(y,function(D,C){if(C!=="insert"){h(this.el).bind(C,function(E){D(E,A)})}},this)}}if(this.legendChild&&this.legendChild.formElement){h(this.legendChild.el).bind("keyup",function(C){if(A.formElement&&A.formElement.legend&&A.parentNode){A.legend=f(A.formElement.legend,A.arrayPath);B.idx=(A.arrayPath.length>0)?A.arrayPath[A.arrayPath.length-1]+1:A.childPos+1;B.value=h(C.target).val();A.legend=w.template(A.legend,B,t);h(A.parentNode.el).trigger("legendUpdated")}})}}h(this.el).find("legend").off().click(function(C){C.preventDefault();C.stopPropagation();var E=h(C.target).hasClass("fa")?h(C.target).parent():h(C.target),F=E.find("#caret"),D=F.hasClass("fa-caret-down")?"fa-caret-right":"fa-caret-down";F.removeClass().addClass("fa "+D);E.parent().children("div").slideToggle()});h(this.el).children(".collapse").hide();w.each(this.children,function(C){C.enhance()})};j.prototype.resetDeleteEvents=function(){var y=this;h(this.el).find("a._jsonform-array-deleteidx").off().click(function(A){var z=h(A.target).parent().attr("data-idx")||h(A.target).parent().parent().attr("data-idx"),B=y.getArrayBoundaries();z=parseInt(z,10);A.preventDefault();A.stopPropagation();if(B.minItems>0){if(y.children.length<B.minItems+2){h(y.el).find("> span > a._jsonform-array-deletelast").addClass("disabled")}if(y.children.length<=B.minItems){return false}}else{if(y.children.length===1){h(y.el).find("> span > a._jsonform-array-deletelast").addClass("disabled")}}y.deleteArrayItem(z);if((B.maxItems>=0)&&(z<=B.maxItems-1)){h(y.el).find("> span > a._jsonform-array-addmore").removeClass("disabled")}})};j.prototype.insertArrayItem=function(y,A){var z=0;if(y===undefined){y=this.children.length}var B=this.childTemplate.clone();this.appendChild(B);B.resetValues();for(z=this.children.length-2;z>=y;z--){this.children[z].moveValuesTo(this.children[z+1])}this.children[y].resetValues();this.children[y].computeInitialValues();for(z=y;z<this.children.length;z++){this.children[z].render(A)}this.resetDeleteEvents();h(B.el).find(".collapse").first().removeClass("collapse")};j.prototype.deleteArrayItem=function(y){var z=0;var A=null;if(y===undefined){y=this.children.length-1}for(z=y;z<this.children.length-1;z++){this.children[z+1].moveValuesTo(this.children[z]);this.children[z].render();h(this.children[z].el).find(".collapse").first().removeClass("collapse")}this.removeChild();this.resetDeleteEvents()};j.prototype.getArrayBoundaries=function(){var y={minItems:-1,maxItems:-1};if(!this.view||!this.view.array){return y}var z=function(C,E){var A=null;var D=null;var B={minItems:-1,maxItems:-1};E=E||C;if(C.view&&C.view.array&&(C!==E)){return B}if(C.key){D=C.key.replace(/\[[0-9]+\]/g,"[]");if(C!==E){D=D.replace(/\[\][^\[\]]*$/,"")}A=n(C.ownerTree.formDesc.schema.properties,D);if(!A){return B}return{minItems:A.minItems||A.minLength||-1,maxItems:A.maxItems||A.maxLength||-1}}else{w.each(C.children,function(G){var F=z(G,E);if(F.minItems!==-1){if(B.minItems!==-1){B.minItems=Math.max(B.minItems,F.minItems)}else{B.minItems=F.minItems}}if(F.maxItems!==-1){if(B.maxItems!==-1){B.maxItems=Math.min(B.maxItems,F.maxItems)}else{B.maxItems=F.maxItems}}})}return B};return z(this)};var i=function(){this.eventhandlers=[];this.root=null;this.formDesc=null};i.prototype.initialize=function(y){y=y||{};this.formDesc=w.clone(y);this.formDesc.prefix=this.formDesc.prefix||"jsonform-"+w.uniqueId();if(this.formDesc.schema&&!this.formDesc.schema.properties){this.formDesc.schema={properties:this.formDesc.schema}}this.formDesc.form=this.formDesc.form||["*",{type:"actions",items:[{type:"submit",value:"Submit"}]}];this.formDesc.form=(w.isArray(this.formDesc.form)?this.formDesc.form:[this.formDesc.form]);this.formDesc.params=this.formDesc.params||{};this.root=new j();this.root.ownerTree=this;this.root.view=a.elementTypes.root;this.buildTree();this.computeInitialValues()};i.prototype.buildTree=function(){w.each(this.formDesc.form,function(z){if(z==="*"){var y=w.clone(this.formDesc.schema.properties),A={};if(this.formDesc.schema.order){w.each(this.formDesc.schema.order,function(B){this.root.appendChild(this.buildFromLayout({key:B}));delete y[B]},this)}w.each(y,function(C,B){if(!w.isUndefined(C.properties)){A[B]=C;return}this.root.appendChild(this.buildFromLayout({key:B}))},this);w.each(A,function(C,B){this.root.appendChild(this.buildFromLayout({key:B}))},this)}else{if(w.isString(z)){z={key:z}}this.root.appendChild(this.buildFromLayout(z))}},this)};i.prototype.buildFromLayout=function(D,y){var A=null;var z=new j();var C=null;var F=null;if(D.key&&this.formDesc.customFormItems){var G=this.formDesc.customFormItems[D.key];if(G!==undefined){G.key=D.key;D=G}}D=w.clone(D);if(D.items){if(w.isArray(D.items)){D.items=w.map(D.items,w.clone)}else{D.items=[w.clone(D.items)]}}if(D.key){A=n(this.formDesc.schema.properties,D.key);if(!A){throw new Error('The JSONForm object references the schema key "'+D.key+'" but that key does not exist in the JSON schema')}if(this.formDesc.onElementSchema){this.formDesc.onElementSchema(D,A)}D.name=D.name||D.key;D.title=D.title||A.title;D.inlinetitle=D.inlinetitle||A.inlinetitle;D.description=D.description||A.description;D.readOnly=D.readOnly||A.readOnly||D.readonly||A.readonly;if(!D.id){D.id=l(this.formDesc.prefix)+"-elt-"+D.key}if(D.allowEmpty){A._jsonform_allowEmpty=true}if(!D.type){if((A.type==="string")&&(A.format==="color")){D.type="color"}else{if((A.type==="number"||A.type==="integer"||A.type==="string"||A.type==="any")&&!A["enum"]){D.type="text"}else{if(A.type==="boolean"){D.type="checkbox"}else{if(A.type==="object"){if(A.properties){D.type="fieldset"}else{D.type="textarea"}}else{if(!w.isUndefined(A["enum"])){D.type="select"}else{D.type=A.type}}}}}}if(!D.options&&A["enum"]){if(D.titleMap){D.options=w.map(A["enum"],function(I){return{value:I,title:D.titleMap[I]||I}})}else{D.options=A["enum"]}}if((D.type==="checkboxes")&&A.items){var B=A.items["enum"];if(B){A.items._jsonform_checkboxes_as_array=true}if(!B&&A.items[0]){B=A.items[0]["enum"];if(B){A.items[0]._jsonform_checkboxes_as_array=true}}}if(A.type==="object"){var E=w.clone(A.properties),H={};if(A.order){w.each(A.order,function(I){z.appendChild(this.buildFromLayout({key:D.key+"."+I}));delete E[I]},this)}w.each(E,function(J,I){if(J.type==="object"){H[I]=J;return}z.appendChild(this.buildFromLayout({key:D.key+"."+I}))},this);w.each(H,function(J,I){z.appendChild(this.buildFromLayout({key:D.key+"."+I}))},this)}}if(!D.type){D.type="none"}C=a.elementTypes[D.type];if(!C){throw new Error('The JSONForm contains an element whose type is unknown: "'+D.type+'"')}if(A){if(!C.inputfield&&!C.array&&(D.type!=="selectfieldset")&&(A.type!=="object")){throw new Error('The JSONForm contains an element that links to an element in the JSON schema (key: "'+D.key+'") and that should not based on its type ("'+D.type+'")')}}else{if(C.inputfield&&(D.type!=="selectfieldset")){throw new Error('The JSONForm defines an element of type "'+D.type+'" but no "key" property to link the input field to the JSON schema')}}D.iddot=l(D.id||"");z.formElement=D;z.schemaElement=A;z.view=C;z.ownerTree=this;if(!D.handlers){D.handlers={}}if(z.view.array){if(D.items){F=D.items[0]||D.items}else{F=D.key+"[]"}if(w.isString(F)){F={key:F}}z.setChildTemplate(this.buildFromLayout(F))}else{if(D.items){w.each(D.items,function(I){if(w.isString(I)){I={key:I}}z.appendChild(this.buildFromLayout(I))},this)}}return z};i.prototype.computeInitialValues=function(){this.root.computeInitialValues(this.formDesc.value)};i.prototype.render=function(y){if(!y){return}this.domRoot=y;this.root.render();if(this.hasRequiredField()){h(y).addClass("jsonform-hasrequired")}};i.prototype.forEachElement=function(z){var y=function(A){for(var B=0;B<A.children.length;B++){z(A.children[B]);y(A.children[B])}};y(this.root)};i.prototype.validate=function(C){var z=a.getFormValue(this.domRoot);var D=false;var A=this.formDesc;if(A.validate!==false){var B=false;if(typeof A.validate!="object"){if(q.JSONFormValidator){B=q.JSONFormValidator.createEnvironment("json-schema-draft-03")}}else{B=A.validate}if(B){var y=B.validate(z,this.formDesc.schema);h(this.domRoot).jsonFormErrors(false,A);if(y.errors.length){if(!D){D=[]}D=D.concat(y.errors)}}}if(D&&!C){if(A.displayErrors){A.displayErrors(D,this.domRoot)}else{h(this.domRoot).jsonFormErrors(D,A)}}return{errors:D}};i.prototype.submit=function(y){var C=function(){if(y){y.preventDefault();y.stopPropagation()}return false};var z=a.getFormValue(this.domRoot);var B=this.formDesc;var A=false;this.forEachElement(function(E){if(A){return}if(E.view.onSubmit){A=!E.view.onSubmit(y,E)}});if(A){return C()}var D=this.validate();if(B.onSubmit&&!B.onSubmit(D.errors,z)){return C()}if(D.errors){return C()}if(B.onSubmitValid&&!B.onSubmitValid(z)){return C()}return false};i.prototype.hasRequiredField=function(){var y=function(z){if(!z){return null}if(z.required&&(z.type!=="boolean")){return z}var A=w.find(z.properties,function(B){return y(B)});if(A){return A}if(z.items){if(w.isArray(z.items)){A=w.find(z.items,function(B){return y(B)})}else{A=y(z.items)}if(A){return A}}};return y(this.formDesc.schema)};a.getFormValue=function(y){var z=h(y).data("jsonform-tree");if(!z){return null}return z.root.getFormValues()};h.fn.jsonFormErrors=function(F,z){h(".error",this).removeClass("error");h(".has-error",this).removeClass("has-error");h(".warning",this).removeClass("warning");h(".jsonform-errortext",this).hide();if(!F){return}var C=[];for(var B=0;B<F.length;B++){var A=F[B].uri.replace(/.*#\//,"").replace(/\//g,".").replace(/\.([0-9]+)(?=\.|$)/g,"[$1]");var E=".jsonform-error-"+l(A.replace(/\./g,"---"));C.push(E);var D=F[B].type||"error";h(E,this).addClass(D);h(E+" > .jsonform-errortext",this).html(F[B].message).show()}C=C.join(",");var y=h(C).get(0);if(y&&y.scrollIntoView){y.scrollIntoView(true,{behavior:"smooth"})}};h.fn.jsonForm=function(y){var A=this;m=y.resourceId;x=y.ouId;k=y.slug;y=w.defaults({},y,{submitEvent:"submit"});var z=new i();z.initialize(y);z.render(A.get(0));if(y.transloadit){A.append('<input type="hidden" name="params" value=\''+p(c.stringify(y.transloadit.params))+"'>")}A.data("jsonform-tree",z);if(y.submitEvent){A.unbind((y.submitEvent)+".jsonform");A.bind((y.submitEvent)+".jsonform",function(B){z.submit(B)})}d(A);h(".expandable > div, .expandable > fieldset",A).hide();h(".expandable > legend",A).click(function(){var B=h(this).parent();B.toggleClass("expanded");h("> div",B).slideToggle(100)});return z};h.fn.jsonFormValue=function(){return a.getFormValue(this)};q.JSONForm=q.JSONForm||{util:{}};q.JSONForm.getFormValue=a.getFormValue;q.JSONForm.fieldTemplate=a.fieldTemplate;q.JSONForm.fieldTypes=a.elementTypes;q.JSONForm.getInitialValue=e;q.JSONForm.initializeTabs=d;q.JSONForm.util.getObjKey=a.util.getObjKey;q.JSONForm.util.setObjKey=a.util.setObjKey})((typeof exports!=="undefined"),((typeof exports!=="undefined")?exports:window),((typeof jQuery!=="undefined")?jQuery:{fn:{}}),((typeof _!=="undefined")?_:null),JSON);